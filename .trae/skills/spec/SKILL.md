---
name: "spec"
description: "根据参考 .spec 文件的配置逻辑重写项目的 .spec 文件，确保生成的 .exe 文件标题栏正常显示图标，且程序运行后能准确识别并读取同级目录下的配置文件。适用于任何需要 PyInstaller 打包的 Python 项目。"
---

# Spec 文件重写工具

## 功能说明

本技能用于根据参考 .spec 文件的配置逻辑，重写项目的 .spec 文件，确保生成的可执行文件具有以下特性：

1. **图标显示**：在程序标题栏和任务栏正常显示应用图标
2. **配置文件读取**：程序运行后能准确识别并读取同级目录下的配置文件
3. **依赖管理**：正确收集所有必要的依赖文件和模块
4. **优化打包**：排除不必要的模块以减小可执行文件体积

## 使用场景

当您需要：
- 为新项目生成 .spec 文件配置
- 重新生成或更新现有项目的 .spec 文件
- 确保打包后的可执行文件能正确显示图标
- 确保打包后的程序能正确读取配置文件
- 优化打包过程和结果
- 为不同项目统一打包配置标准

## 实现原理

1. **参考标准配置结构**：
   - 使用 `sys.argv[0]` 获取 spec 文件路径，确保在不同环境下都能正确定位
   - 自动收集所有必要的依赖文件和模块
   - 对 DLL 文件进行去重处理，避免重复打包
   - 正确配置图标路径和程序属性

2. **项目适配**：
   - 自动识别项目结构和主入口文件
   - 包含项目特定的目录和模块
   - 添加项目所需的隐式导入
   - 配置正确的图标文件路径

3. **配置文件读取支持**：
   - 确保打包配置支持从同级目录读取配置文件
   - 提供配置文件包含的示例代码

## 示例用法

### 基本用法

当您需要为项目生成或更新 .spec 文件时，可使用本技能生成新的配置文件。

### 自定义配置

1. **图标配置**：
   - 默认查找 `icons` 目录下的图标文件
   - 支持 `.ico` 和 `.png` 格式的图标文件

2. **配置文件支持**：
   - 程序运行时能识别同级目录下的配置文件
   - 可根据项目需求添加特定的配置文件

3. **依赖管理**：
   - 自动收集所有必要的依赖模块
   - 可根据项目需求添加或排除特定模块

4. **打包优化**：
   - 使用 UPX 压缩可执行文件
   - 排除不必要的模块以减小体积

## 注意事项

- 运行本技能前，请确保项目中存在图标文件，默认路径为 `icons/app_icon.png` 或 `icons/app_icon.ico`
- 生成的 .spec 文件需要与项目的主入口文件在同一目录下
- 如需包含配置文件，请在生成的 .spec 文件中取消相关注释
- 可根据项目的具体需求，手动调整生成的 .spec 文件中的配置项

## 适配不同项目

本技能适用于以下类型的 Python 项目：
- GUI 应用程序（使用 tkinter、PyQt、PySide 等）
- 命令行工具
- 包含配置文件的应用程序
- 需要特定图标显示的应用程序

无论项目类型如何，本技能都能生成适合的 .spec 文件配置，确保打包过程顺利完成，生成的可执行文件能正常运行。
